<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.test.mj.IRidingDAO">
	
	<!-- 회원가입 -->
	<insert id = "join">
		INSERT INTO MEMBER(USER_ID, ACCESS_ID, JOIN_DATE)
		VALUES(SEQ_MEMBER.NEXTVAL, 1, SYSDATE)
	</insert>
	
	<!-- 개인정보 입력 -->
	<insert id = "profile">
		INSERT INTO PROFILE(PROFILE_ID, USER_ID, MOOD_P_ID, EAT_P_ID, PIMG_ID, DINING_P_ID, SEX_P_ID, AGE_P_ID, EMAIL, BIRTHDAY, SEX, PASSWORD, NICKNAME)
		VALUES(SEQ_PROFILE.NEXTVAL, #{user_id}, #{mood_p_id}, #{eat_p_id}, 1, #{dining_p_id}
		, #{sex_p_id}, #{age_p_id}, #{email}, #{birthday}, #{sex_p_id}, #{password}, #{nickname})
	
	</insert> 
	
	<!-- 회원가입한 userId 얻어내기 (개인정보 insert용) -->
	<select id="getuser" resultType="java.lang.Integer">
		SELECT MAX(TO_NUMBER(USER_ID))
		FROM MEMBER
	</select>
	
	<!-- 탈퇴 회원 테이블에 정보가 있는지 카운트 하기 -->
	<select id="withdrawCheck" resultType="java.lang.Integer">
		SELECT COUNT(*) AS COUNT
		FROM WITHDRAW_USER W JOIN PROFILE P
		ON W.USER_ID = P.USER_ID
		WHERE P.EMAIL = #{email}
		  AND P.BIRTHDAY = #{birthday}
	</select>
	

</mapper>